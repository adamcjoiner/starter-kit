<!DOCTYPE>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Example App using remoteStorage.js caching strategies</title>
  </head>
  <body>
    <p>
      Please connect your remote storage.
    </p>
    <h2>FLUSH</h2>
    <input id="text-flush" />
    <div id="current-flush"></div>
    <input id="get-false-flush" type="submit" value="get (maxAge=undefined)" />
    <input id="get-1000-flush" type="submit" value="get (maxAge=1000)" />
    <h2>SEEN</h2>
    <input id="text-seen" />
    <div id="current-seen"></div>
    <input id="get-false-seen" type="submit" value="get (maxAge=undefined)" />
    <input id="get-1000-seen" type="submit" value="get (maxAge=1000)" />
    <h2>ALL</h2>
    <input id="text-all" />
    <div id="current-all"></div>
    <input id="get-false-all" type="submit" value="get (maxAge=undefined)" />
    <input id="get-1000-all" type="submit" value="get (maxAge=1000)" />
  </body>
  <script src="remotestorage.js"></script>
  <script>
    RemoteStorage._log = true;
    remoteStorage.displayWidget();
    remoteStorage.access.claim('notes', 'rw');

    function $(id) { return document.getElementById(id); }

    var privClient = remoteStorage.scope('/notes/'); //short-cut to get a BaseClient without RemoteStorage.defineModule()
    privClient.cache('flush.txt', 'FLUSH');
    privClient.cache('seen.txt', 'SEEN');
    privClient.cache('all.txt', 'ALL');    

    for (str in {'flush': true, 'seen': true, 'all': true }) {
      defineHandlers(str);
    }
    function defineHandlers(str) {
      $('text-'+str).onkeyup = function() { privClient.storeFile('text/plain', str+'.txt', $('text-'+str).value); };

      $('get-false-'+str).onmousedown = function() {
        $('current-'+str).innerHTML = 'getFile(\''+str+'.txt\', undefined) running...';
        privClient.getFile(str+'.txt', undefined).then(function(obj) {
          $('current-'+str).innerHTML = 'success:'+JSON.stringify(obj);
        }, function(obj) {
          $('current-'+str).innerHTML = 'failure:'+JSON.stringify(obj);
        });
      };

      $('get-1000-'+str).onmousedown = function() {
        $('current-'+str).innerHTML = 'getFile(\''+str+'.txt\', 1000) running...';
        privClient.getFile(str+'.txt', 1000).then(function(obj) {
          $('current-'+str).innerHTML = 'success:'+JSON.stringify(obj);
        }, function(obj) {
          $('current-'+str).innerHTML = 'failure:'+JSON.stringify(obj);
        });
      };
    }
  </script>
</html>