<!DOCTYPE>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>remotestorage.js Example App with Binary Data</title>
  </head>
  <body>
    <p>
      Please connect your remote storage.
    </p>
    Your image:

<!-- code from http://www.html5rocks.com/en/tutorials/file/dndfiles/ start: -->
<style>
  .thumb {
    height: 75px;
    border: 1px solid #000;
    margin: 10px 5px 0 0;
  }
</style>

<input type="file" id="files" name="files[]" multiple />
<output id="list"></output>

<script>
  function handleFileSelect(evt) {
    var files = evt.target.files; // FileList object

    // Loop through the FileList and render image files as thumbnails.
    for (var i = 0, f; f = files[i]; i++) {

      // Only process image files.
      if (!f.type.match('image.*')) {
        continue;
      }

      var reader = new FileReader();

      // Closure to capture the file information.
      reader.onload = (function(theFile) {
        return function(e) {
          remoteStorage.notes.setImage(e.target.result, theFile.type);
        };
      })(f);

      // Read in the image file as an ArrayBuffer.
      reader.readAsArrayBuffer(f);
    }
  }

  document.getElementById('files').addEventListener('change', handleFileSelect, false);
</script>
<!-- code from http://www.html5rocks.com/en/tutorials/file/dndfiles/ end. -->

    <img id="current" />
  </body>
  <script src="remotestorage.js"></script>
  <script src="notes.js"></script>
  <script>
    function $(id) { return document.getElementById(id); }

    function displayImage() {
      remoteStorage.notes.getImage().then(function(result) {
<!-- code from http://remotestorage.io/doc/code/files/baseclient-js.html#RemoteStorage.BaseClient.getFile start: -->
        var blob = new Blob([result.data], { type: result.mimeType });
        $('current').src = window.URL.createObjectURL(blob);
<!-- code from http://remotestorage.io/doc/code/files/baseclient-js.html#RemoteStorage.BaseClient.getFile end. -->
      });
    }

    remoteStorage.access.claim('notes', 'rw');
    remoteStorage.displayWidget();
    remoteStorage.notes.onChange(displayImage);
  </script>
</html>