<!DOCTYPE>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Minimal remoteStorage.js Example App</title>
  </head>
  <body>
    <p>
      Please connect your remote storage.
    </p>
    Your name: <input id="text" />
    <input id="save" type="submit" value="save" />
    <div id="current"></div>
  </body>
  <script src="remotestorage.js"></script>
  <script src="notes.js"></script>
  <script>
    function $(id) { return document.getElementById(id); }

    function displayNote() {
      remoteStorage.notes.getNote().then(function(text) {
          $('current').innerHTML = text ? 'Hello '+text : '';
      });
    }

    remoteStorage.access.claim('notes', 'rw');
    remoteStorage.displayWidget();
    remoteStorage.notes.onChange(displayNote);
    $('save').onclick = function() {
      remoteStorage.notes.setNote($('text').value);
    };
    $('text').addEventListener('keypress', function(e) {
      if(e.keyCode == 13) {//<enter>
        $('save').onclick();
      }
    }, false);

    function setThings() {
      for(var i=0;i<100;i++) {
        (function(i) {
          remoteStorage.notes.setThing('thing'+i, 'bla bla bla').then(
            function(thing) { console.log('set thing success', i); },
            function(error) { console.log('set thing error', i, error); });
        })(i);
      }
    }
    function getThings() {
      for(var i=0;i<100;i++) {
        (function(i) {
          remoteStorage.notes.getThing('thing'+i).then(
            function(thing) { console.log('get thing success', i, thing); },
            function(error) { console.log('get thing error', i, error); });
        })(i);
      }
    }
    getThings();
    displayNote();
  </script>
</html>
